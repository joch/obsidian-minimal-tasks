/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var P=Object.defineProperty;var E=Object.getOwnPropertyDescriptor;var x=Object.getOwnPropertyNames;var $=Object.prototype.hasOwnProperty;var C=(p,u)=>{for(var t in u)P(p,t,{get:u[t],enumerable:!0})},j=(p,u,t,e)=>{if(u&&typeof u=="object"||typeof u=="function")for(let s of x(u))!$.call(p,s)&&s!==t&&P(p,s,{get:()=>u[s],enumerable:!(e=E(u,s))||e.enumerable});return p};var N=p=>j(P({},"__esModule",{value:!0}),p);var L={};C(L,{default:()=>v});module.exports=N(L);var l=require("obsidian"),b=require("@codemirror/view"),I={projectField:"projects",dueField:"due",scheduledField:"scheduled",contextsField:"contexts",discussWithField:"discuss-with",discussDuringField:"discuss-during",storeField:"store",areaField:"area",titleField:"title",statusField:"status",priorityField:"priority",rruleField:"rrule",showProjects:!0,showProjectDueDates:!0,showNoteIcon:!0,showContextPills:!1,noteContentIgnorePattern:'^\\s*```dataviewjs\\s*\\n\\s*await dv\\.view\\("(?:apps\\/dataview\\/)?unified-ribbon"\\);?\\s*\\n\\s*```\\s*',enableConvertIcon:!0,statuses:["none","open","in-progress","done","dropped"],priorities:["anytime","today","someday"]},S=class extends b.WidgetType{constructor(t,e,s,n){super();this.plugin=t;this.taskText=e;this.lineFrom=s;this.lineTo=n}toDOM(t){let e=document.createElement("span");return e.className="minimal-tasks-convert-icon",e.textContent="\u2795",e.title="Convert to action",e.addEventListener("click",s=>{s.preventDefault(),s.stopPropagation(),this.plugin.convertToAction(this.taskText,this.lineFrom,this.lineTo,t)}),e}eq(t){return this.taskText===t.taskText&&this.lineFrom===t.lineFrom}};function A(p){return b.ViewPlugin.fromClass(class{constructor(u){this.decorations=this.buildDecorations(u)}update(u){(u.docChanged||u.viewportChanged)&&(this.decorations=this.buildDecorations(u.view))}buildDecorations(u){let t=[],e=/^(\s*)- \[ \] (.+)$/;for(let{from:s,to:n}of u.visibleRanges)for(let r=s;r<=n;){let i=u.state.doc.lineAt(r),c=i.text.match(e);if(c&&c[2]){let a=b.Decoration.widget({widget:new S(p,c[2],i.from,i.to),side:1});t.push(a.range(i.to))}r=i.to+1}return b.Decoration.set(t,!0)}},{decorations:u=>u.decorations})}var v=class extends l.Plugin{async onload(){console.log("Loading Minimal Tasks plugin"),await this.loadSettings(),window.MinimalTasks={renderTask:this.renderTask.bind(this),renderTaskList:this.renderTaskList.bind(this),settings:this.settings},this.registerDomEvent(document,"click",this.handleClick.bind(this)),this.registerDomEvent(document,"contextmenu",this.handleContextMenu.bind(this)),this.addSettingTab(new M(this.app,this)),this.settings.enableConvertIcon&&this.registerEditorExtension(A(this))}async loadSettings(){this.settings=Object.assign({},I,await this.loadData())}async saveSettings(){await this.saveData(this.settings),window.MinimalTasks&&(window.MinimalTasks.settings=this.settings)}async renderTaskList(t,e,s={}){let n=Array.isArray(e)?e:e.array(),r=await Promise.all(n.map(async a=>({task:a,hasNotes:await this.hasNoteContent(a.file),enrichedTask:await this.enrichTaskData(t,a)})));return this.sortTasks(r).map(a=>this.renderTask(a.enrichedTask,{...s,hasNotes:a.hasNotes})).join("<br>")}async enrichTaskData(t,e){let n=e[this.settings.titleField]||e.file.name.replace(/\.md$/,""),r=`<a data-href="${e.file.path}" href="${e.file.path}" class="internal-link" target="_blank" rel="noopener">${n}</a>`,i,c=e[this.settings.projectField];return c&&c.length>0&&(i=c.map(a=>{var w;let o=typeof a=="string"?a:String(a),d=o.match(/\[\[([^\]|]+)(?:\|([^\]]+))?\]\]/);if(!d)return{link:o};let g=d[1],h=d[2]||((w=g.split("/").pop())==null?void 0:w.replace(/\.md$/,""))||g,m=`<a data-href="${g}" href="${g}" class="internal-link" target="_blank" rel="noopener">${h}</a>`,f=t.page(g);if(!f)return{link:m};if(f[this.settings.dueField]){let k=t.date(f[this.settings.dueField]),F=t.date("today"),T=k.toFormat("MMM dd");return{link:m,due:f[this.settings.dueField],dueFormatted:T,overdue:k<F}}return{link:m}})),{status:e[this.settings.statusField],priority:e[this.settings.priorityField],link:r,file:{path:e.file.path},contexts:e[this.settings.contextsField],"discuss-with":e[this.settings.discussWithField],"discuss-during":e[this.settings.discussDuringField],store:e[this.settings.storeField],due:e[this.settings.dueField],scheduled:e[this.settings.scheduledField],rrule:e[this.settings.rruleField],projects:c,projectsWithMeta:i}}async hasNoteContent(t){var e;try{let s=t.path||((e=t.file)==null?void 0:e.path);if(!s)return!1;let n=this.app.vault.getAbstractFileByPath(s);if(!n||!(n instanceof l.TFile))return!1;let r=await this.app.vault.read(n),i=/^---\n[\s\S]*?\n---\n/,c=r.replace(i,"").trim();if(this.settings.noteContentIgnorePattern)try{let a=new RegExp(this.settings.noteContentIgnorePattern);c=c.replace(a,"").trim()}catch(a){console.error("Invalid noteContentIgnorePattern regex:",a)}return c.length>0}catch(s){return!1}}getEffectiveDueDate(t){var r;let e=t.task[this.settings.dueField],s=((r=t.enrichedTask.projectsWithMeta)==null?void 0:r.map(i=>i.due).filter(Boolean))||[],n=[e,...s].filter(Boolean);return n.length===0?null:n.sort()[0]}sortTasks(t){return t.sort((e,s)=>{let n=this.settings.statusField,r=this.settings.priorityField,i=e.task[n]==="in-progress",c=s.task[n]==="in-progress";if(i&&!c)return-1;if(!i&&c)return 1;let a=e.task[r]==="today",o=s.task[r]==="today";if(a&&!o)return-1;if(!a&&o)return 1;let d=this.getEffectiveDueDate(e),g=this.getEffectiveDueDate(s);if(d&&!g)return-1;if(!d&&g)return 1;if(d&&g){if(d<g)return-1;if(d>g)return 1}return e.task.file.ctime-s.task.file.ctime})}renderTask(t,e={}){let{hasNotes:s=!1,showProjects:n=!0,showContexts:r=!1,excludePills:i=[]}=e,c;if(t.file&&t.file.path)c=t.file.path;else if(t.path)c=t.path;else return console.error("MinimalTasks: No path found in task object",t),"Error: No task path";let a=t[this.settings.statusField]||"none",o=t[this.settings.priorityField]||"anytime",d=a==="done"||a==="dropped",g=this.createControls(o,a,c),h=this.createContent(t,s,d,r,i),m=this.createMainLine(g,h),f=this.createProjectsSection(t,n);return`<div class="minimal-task-row" data-task-path="${c}" data-status="${a}" data-priority="${o}">${m}${f}</div>`}createControls(t,e,s){return`<div class="minimal-task-controls">${this.renderPriorityBadge(t,s)}${this.renderStatusDot(e,s)}</div>`}createContent(t,e,s,n,r){let i=this.createTitle(t,s),c=e&&this.settings.showNoteIcon?'<span class="minimal-task-note-icon">\u2630</span>':"",a=this.createMetadata(t,n,r);return`<div class="minimal-task-content">${i}${c}${a}</div>`}createTitle(t,e){let s=t.link||"Untitled";return`<span class="minimal-task-title${e?" is-completed":""}">${s}</span>`}createMetadata(t,e,s){let n=[],r=this.renderDateBadges(t);r&&n.push(r);let i=t[this.settings.rruleField];i&&!s.includes("recurrence")&&n.push(this.renderRecurrencePill(i));let c=t[this.settings.contextsField]||[];e&&c.length>0&&!s.includes("contexts")&&n.push(this.renderContextPills(c));let a=t[this.settings.discussWithField];a&&!s.includes("person")&&n.push(this.renderDiscussWithPills(a));let o=t[this.settings.discussDuringField];o&&!s.includes("meeting")&&n.push(this.renderDiscussDuringPills(o));let d=t[this.settings.storeField];return d&&!s.includes("store")&&n.push(this.renderStorePill(d)),n.length===0?"":`<span class="minimal-task-metadata">${n.join("")}</span>`}createMainLine(t,e){return`<div class="minimal-task-main">${t}${e}</div>`}createProjectsSection(t,e){if(!this.settings.showProjects||!e)return"";let s=t[this.settings.projectField]||[];return s.length===0?"":`<div class="minimal-task-projects">${(t.projectsWithMeta||s).map(i=>this.createProjectItem(i)).join("")}</div>`}createProjectItem(t){let e="";if(t.link){let s=t;if(e=s.link,this.settings.showProjectDueDates&&s.due){let n=s.dueFormatted||s.due,r=s.overdue?" is-overdue":"";e+=` <span class="minimal-badge minimal-badge-date${r}">\u{1F4C5} ${n}</span>`}}else e=typeof t=="string"?t:String(t);return`<div class="minimal-task-project">${e}</div>`}renderStatusDot(t,e){return`<span class="task-status-dot" data-status="${t}" data-task-path="${e}" title="Status: ${t} (click to cycle)"></span>`}renderPriorityBadge(t,e){let s=this.getPriorityIcon(t);return`<span class="task-priority-badge" data-priority="${t}" data-task-path="${e}" title="Priority: ${t} (click to cycle)">${s}</span>`}renderContextPills(t){return(Array.isArray(t)?t:[t]).map(e=>`<span class="minimal-badge minimal-badge-context">@${e}</span>`).join("")}renderDiscussWithPills(t){return(Array.isArray(t)?t:[t]).map(e=>{let s=this.extractDisplayName(e),n=this.extractLinkPath(e);return n?`<span class="minimal-badge minimal-badge-person"><a class="internal-link" data-href="${n}" href="${n}" target="_blank" rel="noopener">\u{1F464}${s}</a></span>`:`<span class="minimal-badge minimal-badge-person">\u{1F464}${s}</span>`}).join("")}extractDisplayName(t){if(!t)return t;let e=String(t),s=e.match(/\[\[(?:[^\]|]+\|)?([^\]]+)\]\]/);return s?s[1]:e}extractLinkPath(t){if(!t)return null;let s=String(t).match(/\[\[([^\]|]+)(?:\|[^\]]+)?\]\]/);return s?s[1]:null}stripEventPrefix(t){return t&&t.replace(/^\d{4}-\d{2}-\d{2} \d{4} /,"")}renderDiscussDuringPills(t){return(Array.isArray(t)?t:[t]).map(e=>{let s=this.extractDisplayName(e);return`<span class="minimal-badge minimal-badge-meeting">\u{1F4C5}${this.stripEventPrefix(s)}</span>`}).join("")}renderStorePill(t){return`<span class="minimal-badge minimal-badge-store">\u{1F3EA}${t}</span>`}renderRecurrencePill(t){return`<span class="minimal-badge minimal-badge-recurrence">\u{1F501} ${this.formatRRuleReadable(t)}</span>`}formatRRuleReadable(t){if(!t)return"";try{let e=this.parseRRule(t),s=e.FREQ,n=parseInt(e.INTERVAL||"1"),r=e.BYDAY,i=e.BYMONTHDAY,c=e.BYMONTH,a="";if(n===1)switch(s){case"DAILY":a="Daily";break;case"WEEKLY":a="Weekly";break;case"MONTHLY":a="Monthly";break;case"YEARLY":a="Yearly";break}else switch(s){case"DAILY":a=`Every ${n} days`;break;case"WEEKLY":a=`Every ${n} weeks`;break;case"MONTHLY":a=`Every ${n} months`;break;case"YEARLY":a=`Every ${n} years`;break}if(r){let o=r.split(",").map(d=>({SU:"Sun",MO:"Mon",TU:"Tue",WE:"Wed",TH:"Thu",FR:"Fri",SA:"Sat"})[d]||d);a+=" on "+o.join(", ")}return i&&(a+=" on the "+i+this.ordinalSuffix(parseInt(i))),c&&(a+=" in "+["","Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"][parseInt(c)]),a}catch(e){return console.error("Failed to format RRULE:",e),"Recurring"}}parseRRule(t){let e={};return t.split(";").forEach(n=>{let[r,i]=n.split(":").length===2?n.split(":"):n.split("=");r&&i&&(e[r]=i)}),e}ordinalSuffix(t){let e=t%10,s=t%100;return e===1&&s!==11?"st":e===2&&s!==12?"nd":e===3&&s!==13?"rd":"th"}renderDateBadges(t){let e=[],s=t[this.settings.dueField],n=t[this.settings.scheduledField];if(n){let r=new Date(n);r.setHours(0,0,0,0);let i=this.formatDate(r);e.push(`<span class="minimal-badge minimal-badge-date">\u{1F5D3}\uFE0F ${i}</span>`)}if(s){let r=new Date(s);r.setHours(0,0,0,0);let i=new Date;i.setHours(0,0,0,0);let c=r<i,a=this.formatDate(r),o=c?"\u26A0\uFE0F":"\u{1F4C5}",d=c?" is-overdue":"";e.push(`<span class="minimal-badge minimal-badge-date${d}">${o} ${a}</span>`)}return e.join("")}formatDate(t){return`${["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"][t.getMonth()]} ${t.getDate()}`}getPriorityIcon(t){return{today:"\u2B50",someday:"\u{1F4AD}",anytime:"\u2022"}[t]||"\u2022"}async handleClick(t){let e=t.target;if(e.classList.contains("task-status-dot")){t.preventDefault(),t.stopPropagation(),await this.cycleStatus(e);return}if(e.classList.contains("task-priority-badge")){t.preventDefault(),t.stopPropagation(),await this.cyclePriority(e);return}}handleContextMenu(t){let e=t.target;if(e.classList.contains("task-status-dot")){t.preventDefault(),t.stopPropagation(),this.showStatusMenu(e,t);return}if(e.classList.contains("task-priority-badge")){t.preventDefault(),t.stopPropagation(),this.showPriorityMenu(e,t);return}}showStatusMenu(t,e){let s=t.dataset.taskPath,n=t.dataset.status;if(!s)return;let r=new l.Menu;[{value:"none",label:"\u26AA None",icon:"\u26AA"},{value:"open",label:"\u{1F535} Open",icon:"\u{1F535}"},{value:"in-progress",label:"\u{1F7E1} In Progress",icon:"\u{1F7E1}"},{value:"done",label:"\u2705 Done",icon:"\u2705"},{value:"dropped",label:"\u{1F534} Dropped",icon:"\u{1F534}"}].forEach(c=>{r.addItem(a=>{a.setTitle(c.label+(n===c.value?" \u2713":"")).onClick(async()=>{await this.setStatus(t,s,c.value)})})}),r.showAtMouseEvent(e)}showPriorityMenu(t,e){let s=t.dataset.taskPath,n=t.dataset.priority;if(!s)return;let r=new l.Menu;[{value:"anytime",label:"\u2022 Anytime",icon:"\u2022"},{value:"today",label:"\u2B50 Today",icon:"\u2B50"},{value:"someday",label:"\u{1F4AD} Someday",icon:"\u{1F4AD}"}].forEach(c=>{r.addItem(a=>{a.setTitle(c.label+(n===c.value?" \u2713":"")).onClick(async()=>{await this.setPriority(t,s,c.value)})})}),r.showAtMouseEvent(e)}async setStatus(t,e,s){try{await this.updateTaskField(e,"status",s);let n=t.closest(".minimal-task-row");n&&n.setAttribute("data-status",s),t.dataset.status=s;let r=n==null?void 0:n.querySelector(".minimal-task-title");r&&(s==="done"||s==="dropped"?r.classList.add("is-completed"):r.classList.remove("is-completed"));let i={none:"\u26AA None",open:"\u{1F535} Open","in-progress":"\u{1F7E1} In Progress",done:"\u2705 Done",dropped:"\u{1F534} Dropped"};new l.Notice(i[s]||s)}catch(n){console.error("Error setting status:",n),new l.Notice("Error updating task status")}}async setPriority(t,e,s){try{await this.updateTaskField(e,"priority",s),t.dataset.priority=s,t.textContent=this.getPriorityIcon(s);let n={anytime:"\u2022 Anytime",today:"\u2B50 Today",someday:"\u{1F4AD} Someday"};new l.Notice(n[s]||s)}catch(n){console.error("Error setting priority:",n),new l.Notice("Error updating task priority")}}async cycleStatus(t){let e=t.dataset.taskPath,s=t.dataset.status;if(!e)return;let n=["none","open","in-progress","done","dropped"],r=n.indexOf(s||"none"),i=n[(r+1)%n.length];try{await this.updateTaskField(e,"status",i);let c=t.closest(".minimal-task-row");c&&c.setAttribute("data-status",i),t.dataset.status=i;let a=c==null?void 0:c.querySelector(".minimal-task-title");a&&(i==="done"||i==="dropped"?a.classList.add("is-completed"):a.classList.remove("is-completed"));let o={none:"\u26AA None",open:"\u{1F535} Open","in-progress":"\u{1F7E1} In Progress",done:"\u2705 Done",dropped:"\u{1F534} Dropped"};new l.Notice(o[i]||i)}catch(c){console.error("Error cycling status:",c),new l.Notice("Error updating task status")}}async cyclePriority(t){let e=t.dataset.taskPath,s=t.dataset.priority;if(!e)return;let n=["anytime","today","someday"],r=n.indexOf(s||"anytime"),i=n[(r+1)%n.length];try{await this.updateTaskField(e,"priority",i),t.dataset.priority=i,t.textContent=this.getPriorityIcon(i);let c={anytime:"\u2022 Anytime",today:"\u2B50 Today",someday:"\u{1F4AD} Someday"};new l.Notice(c[i]||i)}catch(c){console.error("Error cycling priority:",c),new l.Notice("Error updating task priority")}}async updateTaskField(t,e,s){let n=this.app.vault.getAbstractFileByPath(t);if(!n||!(n instanceof l.TFile))throw new Error(`Task file not found: ${t}`);let r=await this.app.vault.read(n),{frontmatter:i,body:c}=this.parseFrontmatter(r);i.rrule&&String(i.rrule).trim().length>0&&(e==="status"&&s==="done")&&await this.createNextRecurringInstance(i,c),i[e]=s,e==="status"&&s==="done"&&!i.completedDate&&(i.completedDate=new Date().toISOString().split("T")[0]),e==="status"&&s!=="done"&&i.completedDate&&delete i.completedDate;let d=this.rebuildContent(i,c);await this.app.vault.modify(n,d)}async createNextRecurringInstance(t,e){try{new l.Notice("\u{1F501} Creating next instance...",2e3);let s=String(t.rrule).replace(/^["']|["']$/g,""),n=new Date().toISOString().split("T")[0],r=this.calculateNextOccurrence(s,n),i=new Date,d=`gtd/actions/${`${i.toISOString().replace(/[:.]/g,"-").replace("T","-").split("-").slice(0,6).join("").replace(/(\d{4})(\d{2})(\d{2})(\d{2})(\d{2})(\d{2})/,"$1$2$3-$4$5$6")}.md`}`,g=i.toISOString(),h={status:"open",priority:t.priority||"anytime",dateCreated:g,dateModified:g,tags:t.tags||"[]",type:"action",title:t.title||"",contexts:t.contexts||[],area:t.area||'""',scheduled:r,rrule:`"${s}"`};t.projects&&(h.projects=t.projects),t.due&&(h.due=t.due),t.recurrence_start&&(h.recurrence_start=t.recurrence_start),t.store&&(h.store=t.store),t["discuss-with"]&&(h["discuss-with"]=t["discuss-with"]),t["discuss-during"]&&(h["discuss-during"]=t["discuss-during"]);let m=this.rebuildContent(h,e);await this.app.vault.create(d,m),new l.Notice(`\u2705 Completed! Next: ${r}`,3e3)}catch(s){console.error("Failed to create recurring task instance:",s),new l.Notice("\u26A0\uFE0F Failed to create next instance: "+s.message,5e3)}}calculateNextOccurrence(t,e){let s=this.parseRRule(t),n=new Date(e);n.setDate(n.getDate()+1);let r=s.DTSTART;if(!r)throw new Error("DTSTART is required in RRULE");let i=new Date(parseInt(r.substring(0,4)),parseInt(r.substring(4,6))-1,parseInt(r.substring(6,8))),c=s.FREQ;if(!c)throw new Error("FREQ is required in RRULE");let a=parseInt(s.INTERVAL||"1"),o;switch(c){case"DAILY":if(o=new Date(n),s.BYDAY){let y=s.BYDAY.split(",").map(this.dayCodeToNumber);for(;!y.includes(o.getDay());)o.setDate(o.getDate()+1)}else{let D=Math.floor((o.getTime()-i.getTime())/864e5)%a;D!==0&&o.setDate(o.getDate()+(a-D))}break;case"WEEKLY":o=new Date(n);let f=(s.BYDAY||["SU","MO","TU","WE","TH","FR","SA"][i.getDay()]).split(",").map(this.dayCodeToNumber),w=!1;for(let y=0;y<7&&!w;y++){if(f.includes(o.getDay())){if(a===1){w=!0;break}if(Math.floor((o.getTime()-i.getTime())/(1e3*60*60*24*7))%a===0){w=!0;break}}o.setDate(o.getDate()+1)}if(!w)for(o=new Date(n),o.setDate(o.getDate()+a*7);!f.includes(o.getDay());)o.setDate(o.getDate()+1);break;case"MONTHLY":o=new Date(n);let k=s.BYMONTHDAY?parseInt(s.BYMONTHDAY):i.getDate();if(o.setDate(k),o<=n)o.setMonth(o.getMonth()+a);else{let y=(o.getFullYear()-i.getFullYear())*12+(o.getMonth()-i.getMonth());if(y%a!==0){let D=y%a;o.setMonth(o.getMonth()+(a-D))}}for(;o.getDate()!==k;)o.setDate(0),o.setMonth(o.getMonth()+1);break;case"YEARLY":o=new Date(n);let F=s.BYMONTH?parseInt(s.BYMONTH)-1:i.getMonth(),T=s.BYMONTHDAY?parseInt(s.BYMONTHDAY):i.getDate();if(o.setMonth(F),o.setDate(T),o<=n)o.setFullYear(o.getFullYear()+a);else{let y=o.getFullYear()-i.getFullYear();if(y%a!==0){let D=y%a;o.setFullYear(o.getFullYear()+(a-D))}}break;default:throw new Error("Unsupported FREQ: "+c)}let d=o.getFullYear(),g=String(o.getMonth()+1).padStart(2,"0"),h=String(o.getDate()).padStart(2,"0");return`${d}-${g}-${h}`}dayCodeToNumber(t){return{SU:0,MO:1,TU:2,WE:3,TH:4,FR:5,SA:6}[t]||0}parseFrontmatter(t){let e=/^---\n([\s\S]*?)\n---\n?([\s\S]*)$/,s=t.match(e);if(!s)return{frontmatter:{},body:t};let n=s[1],r=s[2],i={},c=n.split(`
`),a=null,o=null;for(let d of c){if(d.trim().startsWith("- ")){o&&o.push(d.trim().substring(2));continue}let g=d.indexOf(":");if(g>0){let h=d.substring(0,g).trim(),m=d.substring(g+1).trim();a=h,m===""?(o=[],i[h]=o):(i[h]=m,o=null)}}return{frontmatter:i,body:r}}rebuildContent(t,e){let s=[];for(let[r,i]of Object.entries(t))Array.isArray(i)?i.length===0?s.push(`${r}: []`):(s.push(`${r}:`),i.forEach(c=>{s.push(`  - ${c}`)})):s.push(`${r}: ${i}`);return`---
${s.join(`
`)}
---
${e}`}refreshDataview(){setTimeout(()=>{try{this.app.commands.executeCommandById("dataview:dataview-rebuild-current-view")}catch(t){this.app.metadataCache.trigger("changed")}},100)}async convertToAction(t,e,s,n){try{let r=await this.detectNoteContext(),i=this.generateTimestamp(),a=`gtd/actions/${`${i}.md`}`,o=this.buildConvertFrontmatter(t,r),d=this.buildActionContent(o);await this.app.vault.create(a,d);let g=`- [ ] [[${i}|${t}]]`;n.dispatch({changes:{from:e,to:s,insert:g}}),new l.Notice(`Created action: ${t}`)}catch(r){console.error("Error converting task:",r),new l.Notice("Error converting task: "+r.message)}}async detectNoteContext(){let t=this.app.workspace.getActiveFile();if(!t)return{};let e=await this.app.vault.read(t),{frontmatter:s}=this.parseFrontmatter(e);return t.path.startsWith("gtd/projects/")&&!t.path.includes("archive")?{projects:[`[[${t.basename}]]`]}:s.type==="event"&&s.project?{projects:[s.project]}:s.area?{area:s.area}:{}}generateTimestamp(){let t=new Date,e=s=>s.toString().padStart(2,"0");return`${t.getFullYear()}${e(t.getMonth()+1)}${e(t.getDate())}-${e(t.getHours())}${e(t.getMinutes())}${e(t.getSeconds())}`}buildConvertFrontmatter(t,e){let s=new Date().toISOString(),n={type:"action",title:t,status:"open",priority:"anytime",dateCreated:s,dateModified:s,tags:[],contexts:[]},r=(e.projects||[]).filter(i=>i?(typeof i=="string"?i:String(i)).trim().length>0:!1);return r.length>0?(n.projects=r,n.area='""'):e.area&&e.area.trim()&&e.area!=='""'?(n.projects=[],n.area=e.area):(n.projects=[],n.area='""'),n}buildActionContent(t){let e='```dataviewjs\nawait dv.view("apps/dataview/unified-ribbon");\n```\n';return this.rebuildContent(t,e)}onunload(){console.log("Unloading Minimal Tasks plugin"),delete window.MinimalTasks}},M=class extends l.PluginSettingTab{constructor(t,e){super(t,e);this.plugin=e}display(){let{containerEl:t}=this;t.empty(),t.createEl("h2",{text:"Minimal Tasks Settings"}),t.createEl("h3",{text:"Frontmatter Field Names"}),t.createEl("p",{text:"Customize which frontmatter fields are used for task metadata.",cls:"setting-item-description"}),new l.Setting(t).setName("Status field").setDesc("Frontmatter field for task status").addText(e=>e.setPlaceholder("status").setValue(this.plugin.settings.statusField).onChange(async s=>{this.plugin.settings.statusField=s,await this.plugin.saveSettings()})),new l.Setting(t).setName("Priority field").setDesc("Frontmatter field for task priority").addText(e=>e.setPlaceholder("priority").setValue(this.plugin.settings.priorityField).onChange(async s=>{this.plugin.settings.priorityField=s,await this.plugin.saveSettings()})),new l.Setting(t).setName("Projects field").setDesc("Frontmatter field for project links (array)").addText(e=>e.setPlaceholder("projects").setValue(this.plugin.settings.projectField).onChange(async s=>{this.plugin.settings.projectField=s,await this.plugin.saveSettings()})),new l.Setting(t).setName("Contexts field").setDesc("Frontmatter field for contexts (array)").addText(e=>e.setPlaceholder("contexts").setValue(this.plugin.settings.contextsField).onChange(async s=>{this.plugin.settings.contextsField=s,await this.plugin.saveSettings()})),new l.Setting(t).setName("Due date field").setDesc("Frontmatter field for due date").addText(e=>e.setPlaceholder("due").setValue(this.plugin.settings.dueField).onChange(async s=>{this.plugin.settings.dueField=s,await this.plugin.saveSettings()})),new l.Setting(t).setName("Scheduled field").setDesc("Frontmatter field for scheduled date").addText(e=>e.setPlaceholder("scheduled").setValue(this.plugin.settings.scheduledField).onChange(async s=>{this.plugin.settings.scheduledField=s,await this.plugin.saveSettings()})),new l.Setting(t).setName("Discuss-with field").setDesc("Frontmatter field for people to discuss with (array)").addText(e=>e.setPlaceholder("discuss-with").setValue(this.plugin.settings.discussWithField).onChange(async s=>{this.plugin.settings.discussWithField=s,await this.plugin.saveSettings()})),new l.Setting(t).setName("Discuss-during field").setDesc("Frontmatter field for meetings to discuss during (array)").addText(e=>e.setPlaceholder("discuss-during").setValue(this.plugin.settings.discussDuringField).onChange(async s=>{this.plugin.settings.discussDuringField=s,await this.plugin.saveSettings()})),new l.Setting(t).setName("Store field").setDesc("Frontmatter field for store/location (errands)").addText(e=>e.setPlaceholder("store").setValue(this.plugin.settings.storeField).onChange(async s=>{this.plugin.settings.storeField=s,await this.plugin.saveSettings()})),new l.Setting(t).setName("Area field").setDesc("Frontmatter field for area/category").addText(e=>e.setPlaceholder("area").setValue(this.plugin.settings.areaField).onChange(async s=>{this.plugin.settings.areaField=s,await this.plugin.saveSettings()})),new l.Setting(t).setName("Title field").setDesc("Frontmatter field for task title").addText(e=>e.setPlaceholder("title").setValue(this.plugin.settings.titleField).onChange(async s=>{this.plugin.settings.titleField=s,await this.plugin.saveSettings()})),t.createEl("h3",{text:"Display Options"}),new l.Setting(t).setName("Show projects").setDesc("Display project links below tasks").addToggle(e=>e.setValue(this.plugin.settings.showProjects).onChange(async s=>{this.plugin.settings.showProjects=s,await this.plugin.saveSettings()})),new l.Setting(t).setName("Show project due dates").setDesc("Show due date warnings for projects").addToggle(e=>e.setValue(this.plugin.settings.showProjectDueDates).onChange(async s=>{this.plugin.settings.showProjectDueDates=s,await this.plugin.saveSettings()})),new l.Setting(t).setName("Show note icon").setDesc("Show \u2630 icon for tasks with content").addToggle(e=>e.setValue(this.plugin.settings.showNoteIcon).onChange(async s=>{this.plugin.settings.showNoteIcon=s,await this.plugin.saveSettings()})),new l.Setting(t).setName("Enable convert icon").setDesc("Show a convert icon at the end of markdown task lines in edit mode. Click to convert to an action file. Requires restart to take effect.").addToggle(e=>e.setValue(this.plugin.settings.enableConvertIcon).onChange(async s=>{this.plugin.settings.enableConvertIcon=s,await this.plugin.saveSettings()})),new l.Setting(t).setName("Note content ignore pattern").setDesc("Regex pattern to ignore when detecting note content. Useful for stripping boilerplate code blocks like ribbons. Leave empty to disable.").addTextArea(e=>e.setPlaceholder('^\\s*```dataviewjs\\s*\\n\\s*await dv\\.view\\("(?:apps\\/dataview\\/)?unified-ribbon"\\);?\\s*\\n\\s*```\\s*').setValue(this.plugin.settings.noteContentIgnorePattern).onChange(async s=>{this.plugin.settings.noteContentIgnorePattern=s,await this.plugin.saveSettings()}))}};
