/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var w=Object.defineProperty;var b=Object.getOwnPropertyDescriptor;var D=Object.getOwnPropertyNames;var S=Object.prototype.hasOwnProperty;var j=(p,h)=>{for(var t in h)w(p,t,{get:h[t],enumerable:!0})},x=(p,h,t,e)=>{if(h&&typeof h=="object"||typeof h=="function")for(let s of D(h))!S.call(p,s)&&s!==t&&w(p,s,{get:()=>h[s],enumerable:!(e=b(h,s))||e.enumerable});return p};var M=p=>x(w({},"__esModule",{value:!0}),p);var C={};j(C,{default:()=>f});module.exports=M(C);var l=require("obsidian"),$={projectField:"projects",dueField:"due",scheduledField:"scheduled",contextsField:"contexts",discussWithField:"discuss-with",discussDuringField:"discuss-during",storeField:"store",areaField:"area",titleField:"title",statusField:"status",priorityField:"priority",showProjects:!0,showProjectDueDates:!0,showNoteIcon:!0,showContextPills:!1,statuses:["none","open","in-progress","done","dropped"],priorities:["anytime","today","someday"]},f=class extends l.Plugin{async onload(){console.log("Loading Minimal Tasks plugin"),await this.loadSettings(),window.MinimalTasks={renderTask:this.renderTask.bind(this),renderTaskList:this.renderTaskList.bind(this),settings:this.settings},this.registerDomEvent(document,"click",this.handleClick.bind(this)),this.registerDomEvent(document,"contextmenu",this.handleContextMenu.bind(this)),this.addSettingTab(new P(this.app,this))}async loadSettings(){this.settings=Object.assign({},$,await this.loadData())}async saveSettings(){await this.saveData(this.settings),window.MinimalTasks&&(window.MinimalTasks.settings=this.settings)}async renderTaskList(t,e,s={}){let i=Array.isArray(e)?e:e.array(),r=await Promise.all(i.map(async o=>({task:o,hasNotes:await this.hasNoteContent(o.file),enrichedTask:await this.enrichTaskData(t,o)})));return this.sortTasks(r.map(o=>o.task)).map(o=>{let d=r.find(c=>c.task.file.path===o.file.path);return d?this.renderTask(d.enrichedTask,{...s,hasNotes:d.hasNotes}):""}).join("<br>")}async enrichTaskData(t,e){let i=e[this.settings.titleField]||e.file.name.replace(/\.md$/,""),r=`<a data-href="${e.file.path}" href="${e.file.path}" class="internal-link" target="_blank" rel="noopener">${i}</a>`,n,a=e[this.settings.projectField];return a&&a.length>0&&(n=a.map(o=>{var F;let d=typeof o=="string"?o:String(o),c=d.match(/\[\[([^\]|]+)(?:\|([^\]]+))?\]\]/);if(!c)return{link:d};let u=c[1],g=c[2]||((F=u.split("/").pop())==null?void 0:F.replace(/\.md$/,""))||u,m=`<a data-href="${u}" href="${u}" class="internal-link" target="_blank" rel="noopener">${g}</a>`,y=t.page(u);if(!y)return{link:m};if(y[this.settings.dueField]){let k=t.date(y[this.settings.dueField]),T=t.date("today"),v=k.toFormat("MMM dd");return{link:m,due:y[this.settings.dueField],dueFormatted:v,overdue:k<T}}return{link:m}})),{status:e[this.settings.statusField],priority:e[this.settings.priorityField],link:r,file:{path:e.file.path},contexts:e[this.settings.contextsField],"discuss-with":e[this.settings.discussWithField],"discuss-during":e[this.settings.discussDuringField],store:e[this.settings.storeField],due:e[this.settings.dueField],scheduled:e[this.settings.scheduledField],projects:a,projectsWithMeta:n}}async hasNoteContent(t){var e;try{let s=t.path||((e=t.file)==null?void 0:e.path);if(!s)return!1;let i=this.app.vault.getAbstractFileByPath(s);if(!i||!(i instanceof l.TFile))return!1;let r=await this.app.vault.read(i),n=/^---\n[\s\S]*?\n---\n/,a=r.replace(n,"").trim(),o=/^\s*```dataviewjs\s*\n\s*await dv\.view\("apps\/dataview\/action-button-ribbon"\);?\s*\n\s*```\s*/;return a=a.replace(o,"").trim(),a.length>0}catch(s){return!1}}sortTasks(t){return t.sort((e,s)=>{let i=this.settings.statusField,r=this.settings.priorityField,n=this.settings.dueField,a=e[i]==="in-progress",o=s[i]==="in-progress";if(a&&!o)return-1;if(!a&&o)return 1;let d=e[r]==="today",c=s[r]==="today";if(d&&!c)return-1;if(!d&&c)return 1;let u=e[n],g=s[n];if(u&&!g)return-1;if(!u&&g)return 1;if(u&&g){if(u<g)return-1;if(u>g)return 1}return e.file.ctime-s.file.ctime})}renderTask(t,e={}){let{hasNotes:s=!1,showProjects:i=!0,showContexts:r=!1,excludePills:n=[]}=e,a;if(t.file&&t.file.path)a=t.file.path;else if(t.path)a=t.path;else return console.error("MinimalTasks: No path found in task object",t),"Error: No task path";let o=t[this.settings.statusField]||"none",d=t[this.settings.priorityField]||"anytime",c=o==="done"||o==="dropped",u=this.createControls(d,o,a),g=this.createContent(t,s,c,r,n),m=this.createMainLine(u,g),y=this.createProjectsSection(t,i);return`<div class="minimal-task-row" data-task-path="${a}" data-status="${o}" data-priority="${d}">${m}${y}</div>`}createControls(t,e,s){return`<div class="minimal-task-controls">${this.renderPriorityBadge(t,s)}${this.renderStatusDot(e,s)}</div>`}createContent(t,e,s,i,r){let n=this.createTitle(t,s),a=e&&this.settings.showNoteIcon?'<span class="minimal-task-note-icon">\u2630</span>':"",o=this.createMetadata(t,i,r);return`<div class="minimal-task-content">${n}${a}${o}</div>`}createTitle(t,e){let s=t.link||"Untitled";return`<span class="minimal-task-title${e?" is-completed":""}">${s}</span>`}createMetadata(t,e,s){let i=[],r=this.renderDateBadges(t);r&&i.push(r);let n=t[this.settings.contextsField]||[];e&&n.length>0&&!s.includes("contexts")&&i.push(this.renderContextPills(n));let a=t[this.settings.discussWithField];a&&!s.includes("person")&&i.push(this.renderDiscussWithPills(a));let o=t[this.settings.discussDuringField];o&&!s.includes("meeting")&&i.push(this.renderDiscussDuringPills(o));let d=t[this.settings.storeField];return d&&!s.includes("store")&&i.push(this.renderStorePill(d)),i.length===0?"":`<span class="minimal-task-metadata">${i.join("")}</span>`}createMainLine(t,e){return`<div class="minimal-task-main">${t}${e}</div>`}createProjectsSection(t,e){if(!this.settings.showProjects||!e)return"";let s=t[this.settings.projectField]||[];return s.length===0?"":`<div class="minimal-task-projects">${(t.projectsWithMeta||s).map(n=>this.createProjectItem(n)).join("")}</div>`}createProjectItem(t){let e="";if(t.link){let s=t;if(e=s.link,this.settings.showProjectDueDates&&s.due){let i=s.dueFormatted||s.due,r=s.overdue?" is-overdue":"";e+=` <span class="minimal-badge minimal-badge-date${r}">\u{1F4C5} ${i}</span>`}}else e=typeof t=="string"?t:String(t);return`<div class="minimal-task-project">${e}</div>`}renderStatusDot(t,e){return`<span class="task-status-dot" data-status="${t}" data-task-path="${e}" title="Status: ${t} (click to cycle)"></span>`}renderPriorityBadge(t,e){let s=this.getPriorityIcon(t);return`<span class="task-priority-badge" data-priority="${t}" data-task-path="${e}" title="Priority: ${t} (click to cycle)">${s}</span>`}renderContextPills(t){return(Array.isArray(t)?t:[t]).map(e=>`<span class="minimal-badge minimal-badge-context">@${e}</span>`).join("")}renderDiscussWithPills(t){return(Array.isArray(t)?t:[t]).map(e=>`<span class="minimal-badge minimal-badge-person">\u{1F464}${e}</span>`).join("")}extractDisplayName(t){if(!t)return t;let e=t.match(/\[\[(?:[^\]|]+\|)?([^\]]+)\]\]/);return e?e[1]:t}stripEventPrefix(t){return t&&t.replace(/^\d{4}-\d{2}-\d{2} \d{4} /,"")}renderDiscussDuringPills(t){return(Array.isArray(t)?t:[t]).map(e=>{let s=this.extractDisplayName(e);return`<span class="minimal-badge minimal-badge-meeting">\u{1F4C5}${this.stripEventPrefix(s)}</span>`}).join("")}renderStorePill(t){return`<span class="minimal-badge minimal-badge-store">\u{1F3EA}${t}</span>`}renderDateBadges(t){let e=[],s=t[this.settings.dueField],i=t[this.settings.scheduledField];if(i){let r=new Date(i);r.setHours(0,0,0,0);let n=this.formatDate(r);e.push(`<span class="minimal-badge minimal-badge-date">\u{1F5D3}\uFE0F ${n}</span>`)}if(s){let r=new Date(s);r.setHours(0,0,0,0);let n=new Date;n.setHours(0,0,0,0);let a=r<n,o=this.formatDate(r),d=a?"\u26A0\uFE0F":"\u{1F4C5}",c=a?" is-overdue":"";e.push(`<span class="minimal-badge minimal-badge-date${c}">${d} ${o}</span>`)}return e.join("")}formatDate(t){return`${["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"][t.getMonth()]} ${t.getDate()}`}getPriorityIcon(t){return{today:"\u2B50",someday:"\u{1F4AD}",anytime:"\u2022"}[t]||"\u2022"}async handleClick(t){let e=t.target;if(e.classList.contains("task-status-dot")){t.preventDefault(),t.stopPropagation(),await this.cycleStatus(e);return}if(e.classList.contains("task-priority-badge")){t.preventDefault(),t.stopPropagation(),await this.cyclePriority(e);return}}handleContextMenu(t){let e=t.target;if(e.classList.contains("task-status-dot")){t.preventDefault(),t.stopPropagation(),this.showStatusMenu(e,t);return}if(e.classList.contains("task-priority-badge")){t.preventDefault(),t.stopPropagation(),this.showPriorityMenu(e,t);return}}showStatusMenu(t,e){let s=t.dataset.taskPath,i=t.dataset.status;if(!s)return;let r=new l.Menu;[{value:"none",label:"\u26AA None",icon:"\u26AA"},{value:"open",label:"\u{1F535} Open",icon:"\u{1F535}"},{value:"in-progress",label:"\u{1F7E1} In Progress",icon:"\u{1F7E1}"},{value:"done",label:"\u2705 Done",icon:"\u2705"},{value:"dropped",label:"\u{1F534} Dropped",icon:"\u{1F534}"}].forEach(a=>{r.addItem(o=>{o.setTitle(a.label+(i===a.value?" \u2713":"")).onClick(async()=>{await this.setStatus(t,s,a.value)})})}),r.showAtMouseEvent(e)}showPriorityMenu(t,e){let s=t.dataset.taskPath,i=t.dataset.priority;if(!s)return;let r=new l.Menu;[{value:"anytime",label:"\u2022 Anytime",icon:"\u2022"},{value:"today",label:"\u2B50 Today",icon:"\u2B50"},{value:"someday",label:"\u{1F4AD} Someday",icon:"\u{1F4AD}"}].forEach(a=>{r.addItem(o=>{o.setTitle(a.label+(i===a.value?" \u2713":"")).onClick(async()=>{await this.setPriority(t,s,a.value)})})}),r.showAtMouseEvent(e)}async setStatus(t,e,s){try{await this.updateTaskField(e,"status",s);let i=t.closest(".minimal-task-row");i&&i.setAttribute("data-status",s),t.dataset.status=s;let r=i==null?void 0:i.querySelector(".minimal-task-title");r&&(s==="done"||s==="dropped"?r.classList.add("is-completed"):r.classList.remove("is-completed"));let n={none:"\u26AA None",open:"\u{1F535} Open","in-progress":"\u{1F7E1} In Progress",done:"\u2705 Done",dropped:"\u{1F534} Dropped"};new l.Notice(n[s]||s)}catch(i){console.error("Error setting status:",i),new l.Notice("Error updating task status")}}async setPriority(t,e,s){try{await this.updateTaskField(e,"priority",s),t.dataset.priority=s,t.textContent=this.getPriorityIcon(s);let i={anytime:"\u2022 Anytime",today:"\u2B50 Today",someday:"\u{1F4AD} Someday"};new l.Notice(i[s]||s)}catch(i){console.error("Error setting priority:",i),new l.Notice("Error updating task priority")}}async cycleStatus(t){let e=t.dataset.taskPath,s=t.dataset.status;if(!e)return;let i=["none","open","in-progress","done","dropped"],r=i.indexOf(s||"none"),n=i[(r+1)%i.length];try{await this.updateTaskField(e,"status",n);let a=t.closest(".minimal-task-row");a&&a.setAttribute("data-status",n),t.dataset.status=n;let o=a==null?void 0:a.querySelector(".minimal-task-title");o&&(n==="done"||n==="dropped"?o.classList.add("is-completed"):o.classList.remove("is-completed"));let d={none:"\u26AA None",open:"\u{1F535} Open","in-progress":"\u{1F7E1} In Progress",done:"\u2705 Done",dropped:"\u{1F534} Dropped"};new l.Notice(d[n]||n)}catch(a){console.error("Error cycling status:",a),new l.Notice("Error updating task status")}}async cyclePriority(t){let e=t.dataset.taskPath,s=t.dataset.priority;if(!e)return;let i=["anytime","today","someday"],r=i.indexOf(s||"anytime"),n=i[(r+1)%i.length];try{await this.updateTaskField(e,"priority",n),t.dataset.priority=n,t.textContent=this.getPriorityIcon(n);let a={anytime:"\u2022 Anytime",today:"\u2B50 Today",someday:"\u{1F4AD} Someday"};new l.Notice(a[n]||n)}catch(a){console.error("Error cycling priority:",a),new l.Notice("Error updating task priority")}}async updateTaskField(t,e,s){let i=this.app.vault.getAbstractFileByPath(t);if(!i||!(i instanceof l.TFile))throw new Error(`Task file not found: ${t}`);let r=await this.app.vault.read(i),{frontmatter:n,body:a}=this.parseFrontmatter(r);n[e]=s,e==="status"&&s==="done"&&!n.completedDate&&(n.completedDate=new Date().toISOString().split("T")[0]),e==="status"&&s!=="done"&&n.completedDate&&delete n.completedDate;let o=this.rebuildContent(n,a);await this.app.vault.modify(i,o)}parseFrontmatter(t){let e=/^---\n([\s\S]*?)\n---\n?([\s\S]*)$/,s=t.match(e);if(!s)return{frontmatter:{},body:t};let i=s[1],r=s[2],n={},a=i.split(`
`),o=null,d=null;for(let c of a){if(c.trim().startsWith("- ")){d&&d.push(c.trim().substring(2));continue}let u=c.indexOf(":");if(u>0){let g=c.substring(0,u).trim(),m=c.substring(u+1).trim();o=g,m===""?(d=[],n[g]=d):(n[g]=m,d=null)}}return{frontmatter:n,body:r}}rebuildContent(t,e){let s=[];for(let[r,n]of Object.entries(t))Array.isArray(n)?(s.push(`${r}:`),n.forEach(a=>{s.push(`  - ${a}`)})):s.push(`${r}: ${n}`);return`---
${s.join(`
`)}
---
${e}`}refreshDataview(){setTimeout(()=>{try{this.app.commands.executeCommandById("dataview:dataview-rebuild-current-view")}catch(t){this.app.metadataCache.trigger("changed")}},100)}onunload(){console.log("Unloading Minimal Tasks plugin"),delete window.MinimalTasks}},P=class extends l.PluginSettingTab{constructor(t,e){super(t,e);this.plugin=e}display(){let{containerEl:t}=this;t.empty(),t.createEl("h2",{text:"Minimal Tasks Settings"}),t.createEl("h3",{text:"Frontmatter Field Names"}),t.createEl("p",{text:"Customize which frontmatter fields are used for task metadata.",cls:"setting-item-description"}),new l.Setting(t).setName("Status field").setDesc("Frontmatter field for task status").addText(e=>e.setPlaceholder("status").setValue(this.plugin.settings.statusField).onChange(async s=>{this.plugin.settings.statusField=s,await this.plugin.saveSettings()})),new l.Setting(t).setName("Priority field").setDesc("Frontmatter field for task priority").addText(e=>e.setPlaceholder("priority").setValue(this.plugin.settings.priorityField).onChange(async s=>{this.plugin.settings.priorityField=s,await this.plugin.saveSettings()})),new l.Setting(t).setName("Projects field").setDesc("Frontmatter field for project links (array)").addText(e=>e.setPlaceholder("projects").setValue(this.plugin.settings.projectField).onChange(async s=>{this.plugin.settings.projectField=s,await this.plugin.saveSettings()})),new l.Setting(t).setName("Contexts field").setDesc("Frontmatter field for contexts (array)").addText(e=>e.setPlaceholder("contexts").setValue(this.plugin.settings.contextsField).onChange(async s=>{this.plugin.settings.contextsField=s,await this.plugin.saveSettings()})),new l.Setting(t).setName("Due date field").setDesc("Frontmatter field for due date").addText(e=>e.setPlaceholder("due").setValue(this.plugin.settings.dueField).onChange(async s=>{this.plugin.settings.dueField=s,await this.plugin.saveSettings()})),new l.Setting(t).setName("Scheduled field").setDesc("Frontmatter field for scheduled date").addText(e=>e.setPlaceholder("scheduled").setValue(this.plugin.settings.scheduledField).onChange(async s=>{this.plugin.settings.scheduledField=s,await this.plugin.saveSettings()})),new l.Setting(t).setName("Discuss-with field").setDesc("Frontmatter field for people to discuss with (array)").addText(e=>e.setPlaceholder("discuss-with").setValue(this.plugin.settings.discussWithField).onChange(async s=>{this.plugin.settings.discussWithField=s,await this.plugin.saveSettings()})),new l.Setting(t).setName("Discuss-during field").setDesc("Frontmatter field for meetings to discuss during (array)").addText(e=>e.setPlaceholder("discuss-during").setValue(this.plugin.settings.discussDuringField).onChange(async s=>{this.plugin.settings.discussDuringField=s,await this.plugin.saveSettings()})),new l.Setting(t).setName("Store field").setDesc("Frontmatter field for store/location (errands)").addText(e=>e.setPlaceholder("store").setValue(this.plugin.settings.storeField).onChange(async s=>{this.plugin.settings.storeField=s,await this.plugin.saveSettings()})),new l.Setting(t).setName("Area field").setDesc("Frontmatter field for area/category").addText(e=>e.setPlaceholder("area").setValue(this.plugin.settings.areaField).onChange(async s=>{this.plugin.settings.areaField=s,await this.plugin.saveSettings()})),new l.Setting(t).setName("Title field").setDesc("Frontmatter field for task title").addText(e=>e.setPlaceholder("title").setValue(this.plugin.settings.titleField).onChange(async s=>{this.plugin.settings.titleField=s,await this.plugin.saveSettings()})),t.createEl("h3",{text:"Display Options"}),new l.Setting(t).setName("Show projects").setDesc("Display project links below tasks").addToggle(e=>e.setValue(this.plugin.settings.showProjects).onChange(async s=>{this.plugin.settings.showProjects=s,await this.plugin.saveSettings()})),new l.Setting(t).setName("Show project due dates").setDesc("Show due date warnings for projects").addToggle(e=>e.setValue(this.plugin.settings.showProjectDueDates).onChange(async s=>{this.plugin.settings.showProjectDueDates=s,await this.plugin.saveSettings()})),new l.Setting(t).setName("Show note icon").setDesc("Show \u2630 icon for tasks with content").addToggle(e=>e.setValue(this.plugin.settings.showNoteIcon).onChange(async s=>{this.plugin.settings.showNoteIcon=s,await this.plugin.saveSettings()}))}};
